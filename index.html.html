<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RecipeHub - Discover Global Flavors</title>
    <meta name="description" content="Explore delicious recipes from around the world. Browse by category, search your favorites, and discover new culinary adventures with RecipeHub.">
    <meta name="keywords" content="recipes, cooking, food, meals, global cuisine, recipe search, cooking ideas">
    <!-- Open Graph Meta Tags for SEO -->
    <meta property="og:title" content="RecipeHub - Discover Global Flavors">
    <meta property="og:description" content="Explore delicious recipes from around the world. Browse by category, search your favorites, and discover new culinary adventures with RecipeHub.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://recipehub.example.com">
    <meta property="og:image" content="https://www.themealdb.com/images/media/meals/logo.png">
    <meta property="og:site_name" content="RecipeHub">
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="RecipeHub - Discover Global Flavors">
    <meta name="twitter:description" content="Explore delicious recipes from around the world.">
    <meta name="twitter:image" content="https://www.themealdb.com/images/media/meals/logo.png">
    <!-- Structured Data for Recipes (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "RecipeHub",
        "url": "https://recipehub.example.com",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://recipehub.example.com/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'warm-beige': '#FFF7ED',
                        'warm-orange': '#FB923C',
                        'warm-orange-dark': '#F97316',
                        'dark-slate': '#0F172A',
                        'dark-card': '#1E293B',
                        'dark-gold': '#FBBF24',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'scale-in': 'scaleIn 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.95)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                    },
                },
            },
        };
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .shadow-elegant { box-shadow: 0 10px 30px -10px rgba(251, 146, 60, 0.2); }
        .dark .shadow-elegant { box-shadow: 0 10px 40px -10px rgba(251, 191, 36, 0.3); }
        .hover-scale { transition: transform 0.3s ease; }
        .hover-scale:hover { transform: scale(1.05); }
        .loader { border: 4px solid rgba(251, 146, 60, 0.2); border-top-color: #FB923C; border-radius: 50%; width: 48px; height: 48px; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .dark .loader { border-color: rgba(251, 191, 36, 0.2); border-top-color: #FBBF24; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        /* Enhanced YouTube iframe styling for better display */
        .youtube-iframe { width: 100%; height: 100%; border: none; border-radius: inherit; }
        /* Preload critical fonts and defer non-critical */
        @font-face { font-family: 'Inter'; font-display: swap; }
    </style>
</head>
<body class="bg-warm-beige dark:bg-dark-slate text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-300">
 
    <!-- Header -->
    <header class="sticky top-0 z-50 backdrop-blur-md bg-white/80 dark:bg-dark-slate/80 border-b border-orange-200 dark:border-gray-700 shadow-sm">
        <nav class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2 text-2xl font-bold text-warm-orange dark:text-dark-gold">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>
                <span>RecipeHub</span>
            </div>
            <!-- Desktop Navigation -->
            <div class="hidden md:flex items-center gap-4 flex-1 max-w-md mx-8">
                <form id="searchForm" class="relative flex-1">
                    <input
                        id="searchInput"
                        type="text"
                        placeholder="Search recipes..."
                        class="w-full pr-10 px-4 py-2 rounded-lg bg-orange-50 dark:bg-gray-700 border border-orange-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-warm-orange dark:focus:ring-dark-gold"
                    />
                    <button type="submit" class="absolute right-1 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-600 rounded">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    </button>
                </form>
                <button id="mealPlanBtn" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Meal Plan</button>
            </div>
            <div class="hidden md:flex items-center gap-2">
                <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" aria-label="Toggle theme">
                    <svg id="sunIcon" class="hidden dark:block" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
                    <svg id="moonIcon" class="block dark:hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
                </button>
            </div>
            <!-- Mobile Menu Button -->
            <button id="mobileMenuBtn" class="md:hidden p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
            </button>
        </nav>
    </header>
    <!-- Mobile Menu -->
    <div id="mobileMenu" class="fixed inset-0 bg-black/50 z-50 hidden md:hidden">
        <div class="bg-white dark:bg-dark-card w-72 h-full p-6 shadow-xl">
            <button id="closeMobileMenu" class="mb-6 text-2xl">&times;</button>
            <form id="mobileSearchForm" class="relative mb-4">
                <input
                    id="mobileSearchInput"
                    type="text"
                    placeholder="Search recipes..."
                    class="w-full px-4 py-2 pr-10 rounded-lg bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600"
                />
                <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                </button>
            </form>
            <button id="mobileMealPlanBtn" class="w-full py-2 px-4 rounded-lg bg-gray-200 dark:bg-gray-600 flex items-center gap-2 justify-start hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4-4V7a4 4 0 0 1 4-4h12a4 4 0 0 1 4 4v12a4 4 0 0 0-4 4zM9 19H5"/></svg>
                <span>Meal Plan</span>
            </button>
            <button id="mobileThemeToggle" class="w-full py-2 px-4 rounded-lg bg-gray-200 dark:bg-gray-600 flex items-center gap-2 justify-start hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors">
                <svg class="hidden dark:block" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
                <svg class="block dark:hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
                <span class="dark:hidden">Dark Mode</span>
                <span class="hidden dark:block">Light Mode</span>
            </button>
        </div>
    </div>
    <!-- Hero Section -->
    <section class="relative bg-gradient-to-r from-warm-orange/20 to-amber-300/20 dark:from-dark-gold/20 dark:to-warm-orange/30 py-16 md:py-24">
        <div class="container mx-auto px-4 text-center animate-fade-in">
            <h1 class="text-4xl md:text-6xl font-bold mb-4 text-gray-900 dark:text-white">Discover Global Flavors</h1>
            <p class="text-lg md:text-xl text-gray-700 dark:text-gray-300 mb-6">Explore delicious recipes from around the world</p>
        </div>
    </section>
    <!-- Main Content -->
    <main class="container mx-auto px-4 py-12">
     
        <!-- Categories Section -->
        <section id="categoriesSection" class="animate-fade-in">
            <h2 class="text-4xl font-bold mb-8 text-center text-gray-900 dark:text-white">Explore by Category</h2>
            <div id="loadingCategories" class="flex justify-center items-center py-20">
                <div class="loader"></div>
            </div>
            <div id="categoryGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 hidden"></div>
        </section>
        <!-- Recipes Section -->
        <section id="recipesSection" class="hidden">
            <div class="mb-8 flex flex-col sm:flex-row justify-between items-center gap-4">
                <h2 id="sectionTitle" class="text-4xl font-bold text-gray-900 dark:text-white"></h2>
                <button id="backToCategories" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    Back to Categories
                </button>
            </div>
            <div id="loadingRecipes" class="flex justify-center items-center py-20 hidden">
                <div class="loader"></div>
            </div>
            <div id="noResults" class="text-center py-20 hidden">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                <h3 class="text-2xl font-bold mb-2 text-gray-900 dark:text-white">No Recipes Found</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-6">Try a different search or browse our categories!</p>
                <button id="browseCategories" class="px-6 py-3 bg-warm-orange dark:bg-dark-gold text-white rounded-lg hover:opacity-90 transition-opacity">Browse Categories</button>
            </div>
            <div id="recipeGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8"></div>
            <div id="loadMoreContainer" class="text-center hidden">
                <button id="loadMore" class="px-6 py-3 bg-warm-orange dark:bg-dark-gold text-white rounded-lg hover:opacity-90 transition-opacity">
                    Load More Recipes
                </button>
            </div>
        </section>
        <!-- Meal Plan Section -->
        <section id="mealPlanSection" class="hidden animate-fade-in">
            <div class="mb-8 flex flex-col sm:flex-row justify-between items-center gap-4">
                <h2 class="text-4xl font-bold text-gray-900 dark:text-white">Weekly Meal Plan</h2>
                <button id="backToHome" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    Back to Categories
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-7 gap-4 mb-8">
                <div class="md:col-span-1"></div>
                <div class="text-center font-semibold text-gray-900 dark:text-white">Monday</div>
                <div class="text-center font-semibold text-gray-900 dark:text-white">Tuesday</div>
                <div class="text-center font-semibold text-gray-900 dark:text-white">Wednesday</div>
                <div class="text-center font-semibold text-gray-900 dark:text-white">Thursday</div>
                <div class="text-center font-semibold text-gray-900 dark:text-white">Friday</div>
                <div class="text-center font-semibold text-gray-900 dark:text-white">Saturday</div>
                <div class="text-center font-semibold text-gray-900 dark:text-white">Sunday</div>
            </div>
            <div class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-7 gap-4">
                    <div class="md:col-span-1 flex items-center justify-center font-semibold text-gray-900 dark:text-white">Breakfast</div>
                    <div id="mon-breakfast" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="tue-breakfast" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="wed-breakfast" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="thu-breakfast" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="fri-breakfast" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="sat-breakfast" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="sun-breakfast" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-7 gap-4">
                    <div class="md:col-span-1 flex items-center justify-center font-semibold text-gray-900 dark:text-white">Lunch</div>
                    <div id="mon-lunch" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="tue-lunch" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="wed-lunch" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="thu-lunch" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="fri-lunch" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="sat-lunch" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="sun-lunch" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-7 gap-4">
                    <div class="md:col-span-1 flex items-center justify-center font-semibold text-gray-900 dark:text-white">Dinner</div>
                    <div id="mon-dinner" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="tue-dinner" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="wed-dinner" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="thu-dinner" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="fri-dinner" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="sat-dinner" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                    <div id="sun-dinner" class="bg-white dark:bg-dark-card rounded-lg p-2 min-h-[80px] border border-gray-200 dark:border-gray-700"></div>
                </div>
            </div>
            <div class="mt-8 text-center">
                <button id="generateShoppingList" class="px-6 py-3 bg-warm-orange dark:bg-dark-gold text-white rounded-lg hover:opacity-90 transition-opacity mr-4">Generate Shopping List</button>
                <button id="clearMealPlan" class="px-6 py-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Clear Plan</button>
            </div>
        </section>
        <!-- Shopping List Modal -->
        <div id="shoppingListModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4" role="dialog">
            <div class="bg-white dark:bg-dark-card rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto shadow-2xl animate-scale-in">
                <div class="p-6">
                    <h3 class="text-2xl font-bold mb-4 text-gray-900 dark:text-white">Shopping List</h3>
                    <ul id="shoppingList" class="space-y-2 mb-6"></ul>
                    <button id="closeShoppingModal" class="w-full px-6 py-3 bg-warm-orange dark:bg-dark-gold text-white rounded-lg hover:opacity-90 transition-opacity">Close</button>
                </div>
            </div>
        </div>
    </main>
    <!-- Recipe Modal -->
    <div id="recipeModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4" role="dialog">
        <div class="bg-white dark:bg-dark-card rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl animate-scale-in">
            <div id="modalScroll" class="overflow-y-auto max-h-[90vh]">
                <div id="modalContent"></div>
            </div>
        </div>
    </div>
    <!-- Add to Plan Modal -->
    <div id="addToPlanModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4" role="dialog">
        <div class="bg-white dark:bg-dark-card rounded-2xl max-w-sm w-full shadow-2xl animate-scale-in">
            <div class="p-6">
                <h3 id="addToPlanTitle" class="text-xl font-bold mb-4 text-gray-900 dark:text-white"></h3>
                <select id="daySelect" class="w-full px-4 py-2 mb-4 rounded-lg bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600">
                    <option value="">Select Day</option>
                    <option value="mon">Monday</option>
                    <option value="tue">Tuesday</option>
                    <option value="wed">Wednesday</option>
                    <option value="thu">Thursday</option>
                    <option value="fri">Friday</option>
                    <option value="sat">Saturday</option>
                    <option value="sun">Sunday</option>
                </select>
                <select id="mealSelect" class="w-full px-4 py-2 mb-4 rounded-lg bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600">
                    <option value="">Select Meal</option>
                    <option value="breakfast">Breakfast</option>
                    <option value="lunch">Lunch</option>
                    <option value="dinner">Dinner</option>
                </select>
                <div class="flex gap-2">
                    <button id="confirmAddToPlan" class="flex-1 px-4 py-2 bg-warm-orange dark:bg-dark-gold text-white rounded-lg hover:opacity-90 transition-opacity">Add</button>
                    <button id="cancelAddToPlan" class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Global State
        const API_BASE = 'https://www.themealdb.com/api/json/v1/1';
        const substitutions = {
            'allspice': '1/2 teaspoon cinnamon, 1/4 teaspoon ginger, and 1/4 teaspoon cloves',
            'arrowroot starch': '1 tablespoon flour OR 1 teaspoon cornstarch',
            'baking mix': '1 cup pancake mix',
            'baking powder': '1/4 teaspoon baking soda plus 1/2 teaspoon cream of tartar',
            'baking soda': '4 teaspoons baking powder',
            'beer': '1 cup nonalcoholic beer OR 1 cup chicken broth',
            'brandy': '1 teaspoon imitation brandy extract plus enough water to make 1/4 cup',
            'bread crumbs': '1 cup cracker crumbs OR 1 cup matzo meal OR 1 cup ground oats',
            'broth': '1 bouillon cube plus 1 cup boiling water OR 1 tablespoon soy sauce plus enough water to make 1 cup',
            'brown sugar': '1 cup white sugar plus 1/4 cup molasses',
            'butter': '1 cup margarine OR 1 cup shortening plus 1/2 teaspoon salt',
            'buttermilk': '1 cup yogurt OR 1 tablespoon lemon juice plus enough milk to make 1 cup',
            'cheddar cheese': '1 cup shredded Colby cheddar OR 1 cup shredded Monterey Jack cheese',
            'chervil': '1 tablespoon chopped fresh parsley',
            'chicken base': '1 cup canned or homemade chicken broth',
            'chocolate': '1 ounce semisweet chocolate chips plus 1 teaspoon shortening',
            'cocoa': '1 (1-ounce) square unsweetened chocolate',
            'condensed cream of mushroom soup': '1 (10.75-ounce) can condensed cream of celery, cream of chicken, or golden mushroom soup',
            'corn syrup': '1 1/4 cup white sugar plus 1/3 cup water OR 1 cup honey',
            'cottage cheese': '1 cup farmer\'s cheese OR 1 cup ricotta cheese',
            'cracker crumbs': '1 cup bread crumbs OR 1 cup matzo meal OR 1 cup ground oats',
            'cream': '7/8 cup milk plus 1 tablespoon butter',
            'egg': '1/4 cup liquid egg substitute OR 3 tablespoons mayonnaise',
            'evaporated milk': '1 cup light cream',
            'farmer\'s cheese': '8 ounces dry cottage cheese',
            'flour': 'For bread: 1 cup all-purpose flour plus 1 teaspoon wheat gluten; For cake: 1 cup all-purpose flour minus 2 tablespoons',
            'garlic': '1/8 teaspoon garlic powder',
            'gelatin': '2 teaspoons agar agar',
            'ginger': '2 teaspoons chopped fresh ginger (for dry) OR 1/2 teaspoon ground dried ginger (for fresh)',
            'green onion': '1/2 cup chopped onion OR 1/2 cup chopped leek',
            'hazelnuts': '1 cup macadamia nuts OR 1 cup almonds',
            'herbs': '1 teaspoon dried herbs (for fresh)',
            'honey': '1 1/4 cup white sugar plus 1/3 cup water',
            'hot pepper sauce': '3/4 teaspoon cayenne pepper plus 1 teaspoon vinegar',
            'lard': '1 cup shortening OR 7/8 cup vegetable oil',
            'lemon grass': '1 tablespoon lemon zest',
            'lemon juice': '1/2 teaspoon vinegar',
            'lemon zest': '1/2 teaspoon lemon extract',
            'lime juice': '1 teaspoon vinegar OR 1 teaspoon lemon juice',
            'lime zest': '1 teaspoon lemon zest',
            'macadamia nuts': '1 cup almonds OR 1 cup hazelnuts',
            'mace': '1 teaspoon nutmeg',
            'margarine': '1 cup shortening plus 1/2 teaspoon salt OR 1 cup butter',
            'mayonnaise': '1 cup sour cream OR 1 cup plain yogurt',
            'milk': '1 cup soy milk OR 1 cup rice milk',
            'mint': '1 tablespoon dried mint leaves (for fresh)',
            'molasses': '3/4 cup brown sugar and 1 teaspoon cream of tartar',
            'mustard': '1 tablespoon dried mustard, 1 teaspoon water, 1 teaspoon vinegar and 1 teaspoon sugar',
            'onion': '1 cup chopped green onions OR 1/4 cup dried minced onion',
            'orange juice': '1 tablespoon other citrus juice',
            'orange zest': '1/2 teaspoon orange extract',
            'parmesan cheese': '1/2 cup grated Asiago cheese OR 1/2 cup grated Romano cheese',
            'parsley': '1 tablespoon chopped fresh chervil OR 1 teaspoon dried parsley',
            'pepperoni': '1 ounce salami',
            'raisin': '1 cup dried currants OR 1 cup dried cranberries',
            'rice': '1 cup cooked barley OR 1 cup cooked bulgur',
            'ricotta': '1 cup dry cottage cheese OR 1 cup silken tofu',
            'rum': '1/2 teaspoon rum extract plus water',
            'saffron': '1/4 teaspoon turmeric',
            'salami': '1 ounce pepperoni',
            'semisweet chocolate chips': '1 cup chocolate candies OR 1 cup peanut butter chips',
            'shallots': '1/2 cup chopped onion OR 1/2 cup chopped leek',
            'shortening': '1 cup butter OR 1 cup margarine minus 1/2 teaspoon salt',
            'sour cream': '1 cup plain yogurt OR 3/4 cup buttermilk mixed with 1/3 cup butter',
            'soy sauce': '1/4 cup Worcestershire sauce mixed with 1 tablespoon water',
            'stock': '1 cube bouillon dissolved in 1 cup water',
            'sweetened condensed milk': '3/4 cup white sugar, 1/2 cup water, 1 1/8 cups dry powdered milk (cooked)',
            'vegetable oil': '1 cup applesauce (for baking) OR 1 cup lard (for frying)',
            'vinegar': '1 teaspoon lemon juice',
            'white sugar': '1 cup brown sugar OR 3/4 cup honey',
            'wine': '1 cup chicken broth OR 1 cup fruit juice mixed with 2 teaspoons vinegar',
            'yeast': '1 cake compressed yeast OR 2 1/2 teaspoons rapid rise yeast',
            'yogurt': '1 cup sour cream OR 1 cup buttermilk'
        };
        let categories = [];
        let recipes = [];
        let displayedRecipes = [];
        let displayCount = 8;
        let currentView = 'categories';
        let selectedMeal = null;
        let mealPlan = JSON.parse(localStorage.getItem('mealPlan')) || {};
        let recipeCache = new Map(); // Cache for recipe details to improve performance
        const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
        const meals = ['breakfast', 'lunch', 'dinner'];
        // DOM Elements
        const html = document.documentElement;
        const categoriesSection = document.getElementById('categoriesSection');
        const recipesSection = document.getElementById('recipesSection');
        const mealPlanSection = document.getElementById('mealPlanSection');
        const categoryGrid = document.getElementById('categoryGrid');
        const recipeGrid = document.getElementById('recipeGrid');
        const loadingCategories = document.getElementById('loadingCategories');
        const loadingRecipes = document.getElementById('loadingRecipes');
        const noResults = document.getElementById('noResults');
        const sectionTitle = document.getElementById('sectionTitle');
        const loadMoreContainer = document.getElementById('loadMoreContainer');
        const loadMore = document.getElementById('loadMore');
        const backToCategories = document.getElementById('backToCategories');
        const browseCategories = document.getElementById('browseCategories');
        const backToHome = document.getElementById('backToHome');
        const recipeModal = document.getElementById('recipeModal');
        const modalContent = document.getElementById('modalContent');
        const searchForm = document.getElementById('searchForm');
        const searchInput = document.getElementById('searchInput');
        const mobileSearchForm = document.getElementById('mobileSearchForm');
        const mobileSearchInput = document.getElementById('mobileSearchInput');
        const themeToggle = document.getElementById('themeToggle');
        const mobileThemeToggle = document.getElementById('mobileThemeToggle');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        const closeMobileMenu = document.getElementById('closeMobileMenu');
        const mealPlanBtn = document.getElementById('mealPlanBtn');
        const mobileMealPlanBtn = document.getElementById('mobileMealPlanBtn');
        const addToPlanModal = document.getElementById('addToPlanModal');
        const addToPlanTitle = document.getElementById('addToPlanTitle');
        const daySelect = document.getElementById('daySelect');
        const mealSelect = document.getElementById('mealSelect');
        const confirmAddToPlan = document.getElementById('confirmAddToPlan');
        const cancelAddToPlan = document.getElementById('cancelAddToPlan');
        const shoppingListModal = document.getElementById('shoppingListModal');
        const shoppingList = document.getElementById('shoppingList');
        const generateShoppingList = document.getElementById('generateShoppingList');
        const clearMealPlan = document.getElementById('clearMealPlan');
        const closeShoppingModal = document.getElementById('closeShoppingModal');
        // Theme Management
        function initTheme() {
            const theme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const shouldBeDark = theme === 'dark' || (!theme && prefersDark);
            if (shouldBeDark) html.classList.add('dark');
        }
        function toggleTheme() {
            html.classList.toggle('dark');
            localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
        }
        themeToggle.addEventListener('click', toggleTheme);
        mobileThemeToggle.addEventListener('click', () => {
            toggleTheme();
            mobileMenu.classList.add('hidden');
        });
        // Mobile Menu
        mobileMenuBtn.addEventListener('click', () => mobileMenu.classList.remove('hidden'));
        closeMobileMenu.addEventListener('click', () => mobileMenu.classList.add('hidden'));
        mobileMenu.addEventListener('click', (e) => {
            if (e.target === mobileMenu) mobileMenu.classList.add('hidden');
        });
        // Navigation
        mealPlanBtn.addEventListener('click', showMealPlan);
        mobileMealPlanBtn.addEventListener('click', () => {
            showMealPlan();
            mobileMenu.classList.add('hidden');
        });
        function showMealPlan() {
            categoriesSection.classList.add('hidden');
            recipesSection.classList.add('hidden');
            mealPlanSection.classList.remove('hidden');
            displayMealPlan();
        }
        function showCategories() {
            mealPlanSection.classList.add('hidden');
            recipesSection.classList.add('hidden');
            categoriesSection.classList.remove('hidden');
        }
        function showRecipes() {
            mealPlanSection.classList.add('hidden');
            categoriesSection.classList.add('hidden');
            recipesSection.classList.remove('hidden');
        }
        backToHome.addEventListener('click', showCategories);
        // Fetch Categories with error handling
        async function loadCategories() {
            try {
                loadingCategories.classList.remove('hidden');
                categoryGrid.classList.add('hidden');
                const response = await fetch(`${API_BASE}/categories.php`);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                categories = data.categories || [];
                displayCategories();
                loadingCategories.classList.add('hidden');
                categoryGrid.classList.remove('hidden');
            } catch (error) {
                console.error('Error loading categories:', error);
                loadingCategories.innerHTML = '<p class="text-center text-red-500">Failed to load categories. Please refresh.</p>';
            }
        }
        function displayCategories() {
            categoryGrid.innerHTML = categories.map(cat => `
                <div class="bg-white dark:bg-dark-card rounded-xl overflow-hidden border border-orange-100 dark:border-gray-700 cursor-pointer hover:shadow-elegant transition-all duration-300 hover-scale group" onclick="handleCategoryClick('${cat.strCategory}')">
                    <div class="relative aspect-[4/3] overflow-hidden">
                        <img src="${cat.strCategoryThumb}" alt="${cat.strCategory} category image" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110" loading="lazy" onerror="this.src='https://via.placeholder.com/300x225?text=${encodeURIComponent(cat.strCategory)}'">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-semibold text-lg text-gray-900 dark:text-white">${cat.strCategory}</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1 line-clamp-2">${cat.strCategoryDescription || ''}</p>
                    </div>
                </div>
            `).join('');
        }
        // Handle Category Click with caching
        async function handleCategoryClick(category) {
            try {
                currentView = 'recipes';
                sectionTitle.textContent = category;
                displayCount = 8;
                showRecipes();
                loadingRecipes.classList.remove('hidden');
                recipeGrid.innerHTML = '';
                noResults.classList.add('hidden');
                loadMoreContainer.classList.add('hidden');
                const response = await fetch(`${API_BASE}/filter.php?c=${encodeURIComponent(category)}`);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                recipes = data.meals || [];
             
                loadingRecipes.classList.add('hidden');
             
                if (recipes.length === 0) {
                    noResults.classList.remove('hidden');
                } else {
                    displayRecipes();
                }
            } catch (error) {
                console.error('Error loading recipes:', error);
                loadingRecipes.classList.add('hidden');
                noResults.classList.remove('hidden');
            }
        }
        // Search Recipes
        async function handleSearch(query) {
            if (!query.trim()) return;
         
            try {
                currentView = 'recipes';
                sectionTitle.textContent = `Search Results: "${query}"`;
                displayCount = 8;
                showRecipes();
                loadingRecipes.classList.remove('hidden');
                recipeGrid.innerHTML = '';
                noResults.classList.add('hidden');
                loadMoreContainer.classList.add('hidden');
                const response = await fetch(`${API_BASE}/search.php?s=${encodeURIComponent(query)}`);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                recipes = data.meals || [];
             
                loadingRecipes.classList.add('hidden');
             
                if (recipes.length === 0) {
                    noResults.classList.remove('hidden');
                } else {
                    displayRecipes();
                }
            } catch (error) {
                console.error('Error searching recipes:', error);
                loadingRecipes.classList.add('hidden');
                noResults.classList.remove('hidden');
            }
        }
        searchForm.addEventListener('submit', (e) => {
            e.preventDefault();
            handleSearch(searchInput.value);
            searchInput.value = '';
        });
        mobileSearchForm.addEventListener('submit', (e) => {
            e.preventDefault();
            handleSearch(mobileSearchInput.value);
            mobileSearchInput.value = '';
            mobileMenu.classList.add('hidden');
        });
        // Display Recipes with enhanced image loading
        function displayRecipes() {
            displayedRecipes = recipes.slice(0, displayCount);
            recipeGrid.innerHTML = displayedRecipes.map(recipe => `
                <div class="bg-white dark:bg-dark-card rounded-xl overflow-hidden border border-orange-100 dark:border-gray-700 cursor-pointer hover:shadow-elegant transition-all duration-300 hover-scale group animate-fade-in">
                    <div class="relative aspect-[4/3] overflow-hidden">
                        <img src="${recipe.strMealThumb}" alt="${recipe.strMeal} recipe image" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110" loading="lazy" onerror="this.src='https://via.placeholder.com/300x225?text=${encodeURIComponent(recipe.strMeal)}'">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-semibold text-lg text-gray-900 dark:text-white line-clamp-2">${recipe.strMeal}</h3>
                        <div class="flex gap-2 mt-2">
                            <button onclick="handleRecipeClick('${recipe.idMeal}'); event.stopPropagation();" class="flex-1 px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">View</button>
                            <button onclick="openAddToPlanModal('${recipe.strMeal}', '${recipe.idMeal}'); event.stopPropagation();" class="px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600">Add to Plan</button>
                        </div>
                    </div>
                </div>
            `).join('');
            if (displayedRecipes.length < recipes.length) {
                loadMoreContainer.classList.remove('hidden');
            } else {
                loadMoreContainer.classList.add('hidden');
            }
        }
        loadMore.addEventListener('click', () => {
            displayCount += 8;
            displayRecipes();
        });
        // Helper to fetch and cache recipe
        async function fetchRecipe(id) {
            if (recipeCache.has(id)) return recipeCache.get(id);
            try {
                const response = await fetch(`${API_BASE}/lookup.php?i=${id}`);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                const meal = data.meals?.[0];
                if (meal) recipeCache.set(id, meal);
                return meal;
            } catch (error) {
                console.error('Error fetching recipe:', error);
                return null;
            }
        }
        // Meal Plan Functions with caching
        async function displayMealPlan() {
            for (const day of days) {
                for (const meal of meals) {
                    const slot = document.getElementById(`${day}-${meal}`);
                    const recipeId = mealPlan[`${day}-${meal}`];
                    if (recipeId) {
                        const recipe = await fetchRecipe(recipeId);
                        if (recipe) {
                            slot.innerHTML = `<div class="text-sm font-medium text-gray-900 dark:text-white">${recipe.strMeal}</div><button onclick="removeFromPlan('${day}', '${meal}')" class="text-xs text-red-500 hover:underline mt-1">Remove</button>`;
                        } else {
                            slot.innerHTML = '<p class="text-sm text-gray-500 dark:text-gray-400 italic">Error loading recipe</p>';
                        }
                    } else {
                        slot.innerHTML = '<p class="text-sm text-gray-500 dark:text-gray-400 italic">No recipe selected</p>';
                    }
                }
            }
        }
        function openAddToPlanModal(recipeName, recipeId) {
            addToPlanTitle.textContent = `Add "${recipeName}" to Plan`;
            daySelect.value = '';
            mealSelect.value = '';
            currentAddingRecipe = { id: recipeId, name: recipeName };
            addToPlanModal.classList.remove('hidden');
        }
        let currentAddingRecipe = null;
        confirmAddToPlan.addEventListener('click', () => {
            const day = daySelect.value;
            const meal = mealSelect.value;
            if (day && meal && currentAddingRecipe) {
                mealPlan[`${day}-${meal}`] = currentAddingRecipe.id;
                localStorage.setItem('mealPlan', JSON.stringify(mealPlan));
                closeAddToPlanModal();
                if (!mealPlanSection.classList.contains('hidden')) {
                    displayMealPlan();
                }
            }
        });
        cancelAddToPlan.addEventListener('click', closeAddToPlanModal);
        function closeAddToPlanModal() {
            addToPlanModal.classList.add('hidden');
        }
        function removeFromPlan(day, meal) {
            delete mealPlan[`${day}-${meal}`];
            localStorage.setItem('mealPlan', JSON.stringify(mealPlan));
            displayMealPlan();
        }
        clearMealPlan.addEventListener('click', async () => {
            if (confirm('Clear entire meal plan?')) {
                mealPlan = {};
                localStorage.setItem('mealPlan', JSON.stringify(mealPlan));
                await displayMealPlan();
            }
        });
        async function generateShoppingListFunc() {
            const allIngredients = {};
            for (const key in mealPlan) {
                const recipeId = mealPlan[key];
                const meal = await fetchRecipe(recipeId);
                if (meal) {
                    for (let i = 1; i <= 20; i++) {
                        const ingredient = meal[`strIngredient${i}`];
                        const measure = meal[`strMeasure${i}`];
                        if (ingredient && ingredient.trim()) {
                            const keyIng = ingredient.toLowerCase();
                            if (!allIngredients[keyIng]) {
                                allIngredients[keyIng] = new Set();
                            }
                            allIngredients[keyIng].add(`${measure} ${ingredient}`);
                        }
                    }
                }
            }
            const listItems = Object.entries(allIngredients).flatMap(([ing, measures]) =>
                Array.from(measures).map(m => `<li class="text-gray-700 dark:text-gray-300">${ing}: ${m}</li>`)
            );
            shoppingList.innerHTML = listItems.join('') || '<li class="text-gray-500 dark:text-gray-400">No ingredients to shop for.</li>';
            shoppingListModal.classList.remove('hidden');
        }
        generateShoppingList.addEventListener('click', generateShoppingListFunc);
        closeShoppingModal.addEventListener('click', () => {
            shoppingListModal.classList.add('hidden');
        });
        shoppingListModal.addEventListener('click', (e) => {
            if (e.target === shoppingListModal) closeShoppingModal.click();
        });
        // Handle Recipe Click with caching
        async function handleRecipeClick(id) {
            selectedMeal = await fetchRecipe(id);
            if (selectedMeal) {
                displayRecipeModal();
            }
        }
        function displayRecipeModal() {
            if (!selectedMeal) return;
            const ingredients = [];
            for (let i = 1; i <= 20; i++) {
                const ingredient = selectedMeal[`strIngredient${i}`];
                const measure = selectedMeal[`strMeasure${i}`];
                if (ingredient && ingredient.trim()) {
                    ingredients.push({ ingredient, measure });
                }
            }
            let youtubeId = '';
            if (selectedMeal.strYoutube) {
                const url = selectedMeal.strYoutube;
                if (url.includes('watch?v=')) {
                    youtubeId = url.split('v=')[1]?.split('&')[0] || '';
                } else if (url.includes('youtu.be/')) {
                    youtubeId = url.split('/').pop()?.split('?')[0] || '';
                }
            }
            const subsList = ingredients.map(item => {
                const sub = substitutions[item.ingredient.toLowerCase()] || 'No common substitution available';
                return `<li class="flex items-start gap-2 text-gray-700 dark:text-gray-300">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-warm-orange dark:text-dark-gold mt-1 flex-shrink-0"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                    <span class="text-sm"><span class="font-medium">${item.ingredient}:</span> ${sub}</span>
                </li>`;
            }).join('');
            const videoHtml = youtubeId ? `
                <div>
                    <h3 class="text-xl font-semibold mb-4 flex items-center gap-2 text-gray-900 dark:text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-warm-orange dark:text-dark-gold"><path d="M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17"/><path d="m10 15 5-3-5-3z"/></svg>
                        Video Tutorial
                    </h3>
                    <div class="aspect-video rounded-lg overflow-hidden">
                        <iframe
                            class="youtube-iframe"
                            src="https://www.youtube.com/embed/${youtubeId}?rel=0&modestbranding=1&playsinline=1&enablejsapi=1"
                            title="${selectedMeal.strMeal} video tutorial"
                            loading="lazy"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                            referrerpolicy="strict-origin-when-cross-origin"
                            allowfullscreen
                        ></iframe>
                    </div>
                </div>
            ` : '';
            modalContent.innerHTML = `
                <div class="relative">
                    <img src="${selectedMeal.strMealThumb}" alt="${selectedMeal.strMeal} hero image" class="w-full h-72 object-cover" loading="lazy" onerror="this.src='https://via.placeholder.com/800x300?text=${encodeURIComponent(selectedMeal.strMeal)}'">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                    <div class="absolute bottom-0 left-0 right-0 p-6 text-white">
                        <h2 class="text-3xl font-bold mb-2">${selectedMeal.strMeal}</h2>
                        <div class="flex gap-2 flex-wrap">
                            <span class="px-3 py-1 bg-white/90 text-gray-900 rounded-full text-sm font-medium">${selectedMeal.strCategory}</span>
                            <span class="px-3 py-1 bg-white/90 text-gray-900 rounded-full text-sm font-medium">${selectedMeal.strArea}</span>
                        </div>
                    </div>
                    <button id="closeModalBtn" class="absolute top-4 right-4 w-10 h-10 bg-white/90 dark:bg-gray-800/90 rounded-full flex items-center justify-center hover:bg-white dark:hover:bg-gray-700 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                </div>
                <div class="p-6 space-y-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-xl font-semibold mb-4 flex items-center gap-2 text-gray-900 dark:text-white">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-warm-orange dark:text-dark-gold"><path d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/></svg>
                                Ingredients
                            </h3>
                            <ul class="space-y-2">
                                ${ingredients.map(item => `
                                    <li class="flex items-start gap-2 text-gray-700 dark:text-gray-300">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-warm-orange dark:text-dark-gold mt-1 flex-shrink-0"><path d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/></svg>
                                        <span class="text-sm"><span class="font-medium">${item.measure}</span> ${item.ingredient}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold mb-4 flex items-center gap-2 text-gray-900 dark:text-white">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-warm-orange dark:text-dark-gold"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                                Substitutions
                            </h3>
                            <ul class="space-y-2 max-h-48 overflow-y-auto">
                                ${subsList}
                            </ul>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">Instructions</h3>
                        <p class="text-sm leading-relaxed whitespace-pre-line text-gray-700 dark:text-gray-300">
                            ${selectedMeal.strInstructions}
                        </p>
                    </div>
                    ${videoHtml}
                    <div class="flex gap-2">
                        <button onclick="openAddToPlanModal('${selectedMeal.strMeal}', '${selectedMeal.idMeal}')" class="flex-1 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">Add to Meal Plan</button>
                    </div>
                </div>
            `;
            recipeModal.classList.remove('hidden');
            // Attach close event to button
            document.getElementById('closeModalBtn')?.addEventListener('click', closeModal);
        }
        function closeModal() {
            recipeModal.classList.add('hidden');
        }
        recipeModal.addEventListener('click', (e) => {
            if (e.target === recipeModal) closeModal();
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !recipeModal.classList.contains('hidden')) {
                closeModal();
            }
        });
        addToPlanModal.addEventListener('click', (e) => {
            if (e.target === addToPlanModal) closeAddToPlanModal();
        });
        // Back to Categories
        function handleBackToCategories() {
            currentView = 'categories';
            showCategories();
            recipes = [];
            displayCount = 8;
        }
        backToCategories.addEventListener('click', handleBackToCategories);
        browseCategories.addEventListener('click', handleBackToCategories);
        // Initialize
        initTheme();
        showCategories();
        loadCategories();
        // Preload critical resources for better performance
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js'); // Optional: Add a service worker for caching
        }
    </script>
</body>
</html>